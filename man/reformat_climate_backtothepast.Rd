% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reformat_climate_backtothepast.R
\name{reformat_climate_backtothepast}
\alias{reformat_climate_backtothepast}
\title{Reformat Climate Data for Time-Lagged Window Analysis}
\usage{
reformat_climate_backtothepast(
  yearsref = 2000,
  climate_data = climate_data,
  yearneed = 2,
  refday = 274,
  lastdays = 1095,
  rollwin = 1,
  covariates.of.interest = "temperature.degree",
  align.moving = "right"
)
}
\arguments{
\item{yearsref}{Integer. The reference year from which to anchor the backward window. Typically corresponds to a seed or biological event year.}

\item{climate_data}{Data frame. Must include \code{year}, \code{yday}, \code{LONGITUDE}, \code{LATITUDE}, \code{date}, and the target climate variable.}

\item{yearneed}{Integer. Number of years of prior data to include. Controls how far back the data will be gathered. Default is 2.}

\item{refday}{Integer. Day of year (DOY) representing the reference event (e.g., 305 for Nov 1st). Adjusted for leap years if applicable.}

\item{lastdays}{Integer. Number of days to include in the backward time window. Default is 1095 (â‰ˆ 3 years).}

\item{rollwin}{Integer. Rolling average window size (in days). Default is 1 (no smoothing).}

\item{covariates.of.interest}{Character. Name of the climate variable column to apply the rolling average to (e.g., \code{"TMEAN"}).}

\item{align.moving}{Character. Alignment of the rolling mean (\code{"right"}, \code{"left"}, or \code{"center"}). Passed to \code{zoo::rollmeanr}. Default is \code{"right"}.}
}
\value{
A data frame with columns:
\item{LONGITUDE, LATITUDE, year, date, yday}{Metadata and temporal structure.}
\item{days.reversed}{The backward time index from the reference day (1 = most recent).}
\item{<climate_variable>}{Smoothed (or raw) values of the climate variable specified.}
}
\description{
This function extracts and processes historical daily climate data relative to a reference date.
It constructs a "reversed day" timeline for backward-looking analyses (e.g., climate cue detection),
applies a rolling average (if specified), and prepares the data for use in time-window modeling.
}
\details{
The function:
\itemize{
\item Validates inputs and ensures required columns are present.
\item Handles leap years by adjusting \code{refday} if needed.
\item Filters the climate data for the target window (\code{yearref - yearneed} to \code{yearref}).
\item Reverses the daily time vector for backward analysis (e.g., day -1, -2, ..., -1095).
\item Computes a rolling average on the climate variable (optional).
\item Outputs a clean data frame suitable for merging with biological observations.
}
}
\examples{
\dontrun{
processed <- reformat_climate_backtothepast(
  yearsref = 2020,
  climate_data = my_climate_df,
  yearneed = 2,
  refday = 305,
  lastdays = 700,
  rollwin = 7,
  covariates.of.interest = "TMEAN"
)
head(processed)
}

}
\seealso{
\code{\link[zoo]{rollmean}}, \code{\link[lubridate]{leap_year}}, \code{\link[dplyr]{mutate}}
}
