% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runing_peak_detection.R
\name{runing_peak_detection}
\alias{runing_peak_detection}
\title{Identify Weather Cue Windows Using Threshold-Based Peak Detection}
\usage{
runing_peak_detection(
  lag = 100,
  threshold = 3,
  influence = 0,
  tolerancedays = 7,
  refday = 305,
  lastdays = 600,
  rollwin = 1,
  siteforsub = "longitude=-0.15_latitude=50.85",
  climate_data = climate_data,
  Results_days = Results_days,
  bio_data = bio_data,
  yearneed = 2,
  formula_model = formula("log.seed ~ TMEAN"),
  model_type = "lm"
)
}
\arguments{
\item{lag}{Integer. The number of past observations used to compute the rolling mean and standard deviation
in the thresholding algorithm. Larger values smooth the baseline. Default is 100.}

\item{threshold}{Numeric. The number of standard deviations a value must exceed the rolling mean to be
considered a signal. Default is 3.}

\item{influence}{Numeric between 0 and 1. Determines the influence of detected signals on the rolling
statistics; 0 means no influence. Default is 0 (fully robust).}

\item{tolerancedays}{Integer. Number of days allowed as gaps within a signal to still consider it part of
a continuous window. Default is 7.}

\item{refday}{Integer. Day of year used as a reference (e.g., 305 = Nov 1). Default is 305.}

\item{lastdays}{Integer. Number of days before \code{refday} to include in the analysis. Default is 600.}

\item{rollwin}{Integer. Window size for rolling average in climate data. Default is 1.}

\item{siteforsub}{Character. Unique site identifier (e.g., "longitude=16.71_latitude=53.09").}

\item{climate_data}{Data frame. Daily climate data, must include a \code{year} column and the covariate(s) used
in modeling (e.g., \code{TMEAN}).}

\item{Results_days}{Data frame. Output from CSP analysis including slope (\code{estimate}) and R² (\code{r.squared})
columns for each day.}

\item{bio_data}{Data frame. Biological data for the site (e.g., seed production), must include \code{plotname.lon.lat},
\code{Year}, and modeled response variable (e.g., \code{log.seed}).}

\item{yearneed}{Integer. Number of years required for cross-validation or fitting. Default is 2.}

\item{formula_model}{Formula. The model to fit (e.g., \code{log.seed ~ TMEAN}). Default is \code{log.seed ~ TMEAN}.}

\item{model_type}{Character. Type of model to fit. Either \code{"lm"} or \code{"gam"}. Default is \code{"lm"}.}
}
\value{
A data frame with model summaries (e.g., slope, R², AIC) for each identified cue window. If no
significant windows are found, the function returns an empty object or message.
}
\description{
This function identifies potential weather cue windows from climate data using a thresholding algorithm
applied to the product of slope and R² values obtained from a prior CSP (climate sensitivity profile) analysis.
Peaks are identified when this product exceeds a specified threshold of deviation from a moving average.
}
\details{
The function applies a z-score-based peak detection algorithm to identify the most informative time windows
based on signal strength (product of slope and R² from CSP). These windows are then evaluated using linear or
generalized additive models over historical climate data.
}
\examples{
\dontrun{
result <- runing_peak_detection_site(
  lag = 100,
  threshold = 3,
  influence = 0,
  siteforsub = "longitude=16.71_latitude=53.09",
  climate_data = climate_df,
  Results_days = csp_output,
  bio_data = seed_data
)
}

}
