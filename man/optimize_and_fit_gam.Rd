% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/optimize_and_fit_gam.R
\name{optimize_and_fit_gam}
\alias{optimize_and_fit_gam}
\title{Optimize and Fit Generalized Additive Models (GAMs)}
\usage{
optimize_and_fit_gam(temporary, optim.k = TRUE, plots = F, k = 20)
}
\arguments{
\item{temporary}{A data frame or tibble containing the input data. Must contain at least the columns: \code{day}, \code{slope}, and \code{r_s}.}

\item{optim.k}{Logical. If \code{TRUE}, the function attempts to optimize the number of knots \code{k} by checking significance
of smooth terms using \code{mgcv::k.check}. If \code{FALSE}, a fixed value for \code{k} is used. Default is \code{TRUE}.}

\item{plots}{Logical. If \code{TRUE}, plots of the fitted GAM models with partial effects and residuals are displayed using \code{gratia}. Default is \code{FALSE}.}

\item{k}{Integer. The number of knots to use for the GAM smooth term if \code{optim.k = FALSE}. Ignored if \code{optim.k = TRUE}. Default is \code{20}.}
}
\value{
A list with the following components:
\itemize{
\item \code{slope_gam}: Fitted GAM for the slope variable.
\item \code{rs_gam}: Fitted GAM for the RÂ² variable.
\item \code{k}: The number of knots used in the GAM fitting.
}
}
\description{
This function fits two Generalized Additive Models (GAMs) to describe the relationship between a time variable (\code{day})
and two response variables (\code{slope} and \code{r.squared}) typically derived from a Climate Sensitivity Profile (CSP).
It includes the option to automatically optimize the number of knots (\code{k}) for the smooth term using \code{mgcv::k.check}.
}
\details{
If \code{optim.k = TRUE}, the function iteratively fits GAMs across a range of \code{k} values (from 10 to 365)
and performs \code{k.check} until it finds a value of \code{k} with all significant smooth term p-values (p < 0.05).
If no suitable \code{k} is found, it defaults to \code{k = -1}.

Two separate models are fit:
\itemize{
\item \code{slope_gam}: GAM model of \code{slope ~ s(day)}
\item \code{rs_gam}: GAM model of \code{r_s ~ s(day)}
}

If \code{plots = TRUE}, both models are visualized using \code{gratia::draw()} and displayed via \code{cowplot::plot_grid()}.
}
\examples{
set.seed(42)
temp_df <- data.frame(
  day = 1:365,
  slope = rnorm(365, mean = 0, sd = 0.5),
  r_s = runif(365, min = 0, max = 1)
)

# Automatic knot optimization
result <- optimize_and_fit_gam(temp_df, optim.k = TRUE, plots = TRUE)

# Use fixed number of knots
result_fixed <- optimize_and_fit_gam(temp_df, optim.k = FALSE, k = 30, plots = TRUE)

}
