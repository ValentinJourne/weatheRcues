% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runing_psr.R
\name{runing_psr}
\alias{runing_psr}
\title{Run P-spline Regression (PSR) to Identify Weather Cues}
\usage{
runing_psr(
  bio_data = bio_data,
  site = site,
  climate_data = climate_data,
  lastdays = 600,
  refday = 305,
  rollwin = 1,
  formula_model = formula("log.seed ~ TMEAN"),
  matrice = c(3, 1),
  knots = NULL,
  tolerancedays = 7,
  yearneed = 2
)
}
\arguments{
\item{bio_data}{A data frame containing biological data, including columns such as \code{year}, \code{plotname.lon.lat}, \code{sitenewname}, and the response variable (e.g., \code{log.seed}).}

\item{site}{Character. The site identifier, which must match values in the \code{plotname.lon.lat} column of \code{bio_data}.}

\item{climate_data}{A data frame containing climate data, with columns for \code{year}, \code{yday}, and the climate variable of interest (e.g., \code{TMEAN}).}

\item{lastdays}{Integer. The number of days before the reference date to include in the analysis. Default is 600.}

\item{refday}{Integer. The reference day of year (DOY) from which to track backward. Default is 305 (i.e., November 1st).}

\item{rollwin}{Integer. Size of the rolling window to smooth climate data. Default is 1 (i.e., no smoothing).}

\item{formula_model}{A formula describing the relationship between the biological response and the climate predictor. Default is \code{log.seed ~ TMEAN}.}

\item{matrice}{Numeric vector of length 2. Controls the order of the B-spline and the penalty difference (see \code{mgcv::s}). Default is \code{c(3, 1)}.}

\item{knots}{Integer or NULL. Number of knots for the smooth spline. If NULL (default), it is set to \code{number of years - 1}.}

\item{tolerancedays}{Integer. Tolerance in days for identifying contiguous periods of significance. Default is 7.}

\item{yearneed}{Integer. Number of years of data required for modeling each subset. Default is 2.}
}
\value{
A data frame summarizing:
\itemize{
\item \code{window.open} and \code{window.close} – Identified window bounds.
\item \code{estimate}, \code{intercept}, \code{r2}, \code{AIC} – Model fit statistics.
\item \code{nobs}, \code{nsequence.id} – Number of observations and identified window sequences.
}
}
\description{
This function applies Penalized Spline Regression (PSR) to identify temporal windows during which climate variables (e.g., temperature) significantly influence a biological response variable (e.g., seed production) at a given site. The method is adapted from Roberts et al. and Simmonds et al., and is suitable for exploring time-lagged climate–biology relationships using generalized additive models (GAMs) with a penalized spline term.
}
\details{
The function reformats the climate data into a matrix where each row corresponds to a year and columns to daily values. A GAM is fit using penalized splines to assess the relationship between the response and predictor across time. Significant periods are identified as those where partial effects exceed ±1.96 standard deviations from the mean effect.

If no significant period is found, a data frame with \code{NA} values is returned. If significant periods are found, the function returns a summary data frame for each detected window, including the model's fit statistics and effect estimates.
}
\examples{
\dontrun{
result <- runing_psr(
  bio_data = bio_df,
  site = "site_001",
  climate_data = climate_df,
  lastdays = 600,
  refday = 305,
  formula_model = log.seed ~ TMEAN
)
}

}
\seealso{
\code{\link[mgcv]{gam}}, \code{\link{extract_sequences_auto}}, \code{\link{reruning_windows_modelling}}
}
