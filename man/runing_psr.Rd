% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runing_psr.R
\name{runing_psr}
\alias{runing_psr}
\title{Identify Weather Cue Windows Using Penalized Spline Regression (PSR)}
\usage{
runing_psr(
  bio_data = bio_data,
  site = site,
  climate_data = climate_data,
  lastdays = 600,
  refday = 305,
  rollwin = 1,
  formula_model = formula("log.seed ~ TMEAN"),
  matrice = c(3, 1),
  knots = NULL,
  tolerancedays = 7,
  yearneed = 2
)
}
\arguments{
\item{bio_data}{A data frame containing biological data. Must include columns such as \code{year}, \code{plotname.lon.lat}, \code{sitenewname}, and the response variable used in \code{formula_model}.}

\item{site}{Character. Site name corresponding to entries in the \code{plotname.lon.lat} column of \code{bio_data}.}

\item{climate_data}{A data frame of daily climate data. Must include \code{year}, \code{yday}, and the climate variable specified in \code{formula_model}.}

\item{lastdays}{Integer. Number of days before the reference date to include in the analysis. Default is 600.}

\item{refday}{Integer. Reference day of year (DOY) from which to look backward in time. Default is 305 (November 1).}

\item{rollwin}{Integer. Size of the rolling window used to smooth climate data. Default is 1 (no smoothing).}

\item{formula_model}{A formula describing the relationship between the biological response and climate variable (e.g., \code{log.seed ~ TMEAN}).}

\item{matrice}{A numeric vector of length 2 controlling the order of the spline and the penalty difference order. See \code{mgcv::s()}. Default is \code{c(3, 1)}.}

\item{knots}{Integer or NULL. Number of knots for the spline basis. If NULL (default), it is set to the number of years minus 1.}

\item{tolerancedays}{Integer. Number of days allowed as gaps when defining contiguous significant windows. Default is 7.}

\item{yearneed}{Integer. Minimum number of years required to include in rolling climate window construction. Default is 2.}
}
\value{
A data frame with one row per identified window, including:
\itemize{
\item \code{window.open}, \code{window.close} – bounds of the identified window
\item \code{estimate}, \code{intercept} – effect size estimates
\item \code{r2}, \code{AIC}, \code{nobs} – model performance metrics
\item \code{sitenewname}, \code{plotname.lon.lat}, \code{reference.day}, \code{nsequence.id} – metadata
}
}
\description{
This function applies Penalized Spline Regression (PSR) to identify critical climate windows affecting a biological response variable (e.g., seed production) at a site. Based on the method of Roberts et al. and adapted by Simmonds et al., the approach uses generalized additive models (GAMs) with penalized splines to detect influential time periods by modeling the interaction between time and climate covariates.
}
\details{
The climate data is reshaped into a matrix of years (rows) by days (columns), and smoothed using penalized splines within a GAM framework.
The partial effect curve of the climate covariate is extracted, and days with values exceeding ±1.96 standard deviations from the mean are considered significant.

Detected periods are grouped into windows of influence. A linear model is then fit within each window to extract fit statistics (R², AIC, etc.).

If no significant window is found, the function returns a one-row data frame with NA values.
}
\examples{
\dontrun{
result <- runing_psr(
  bio_data = bio_df,
  site = "site_001",
  climate_data = climate_df,
  lastdays = 600,
  refday = 305,
  formula_model = log.seed ~ TMEAN
)
}

}
\seealso{
\code{\link[mgcv]{gam}}, \code{\link{extract_sequences_auto}}, \code{\link{reruning_windows_modelling}}
}
