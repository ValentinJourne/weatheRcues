% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runing_csp.R
\name{runing_csp}
\alias{runing_csp}
\title{Run Climate Sensitivity Profile (CSP) Window Identification for a Site}
\usage{
runing_csp(
  Results_days = Results_days,
  bio_data = bio_data,
  siteneame.forsub = siteneame.forsub,
  option.check.name = TRUE,
  climate_data = climate_data,
  refday = 305,
  lastdays = max(range),
  rollwin = 1,
  optim.k = F,
  formula_model = formula("seed~TMEAN"),
  model_type = "lm",
  yearneed = 2,
  k.provided = NA
)
}
\arguments{
\item{Results_days}{A data frame with daily results from a previous CSP analysis. Must contain \code{estimate} (slope) and \code{r.squared} for each lag day.}

\item{bio_data}{A data frame of biological data (e.g., seed production). Must include identifiers such as \code{plotname.lon.lat}, \code{sitenewname}, \code{year}, and the response variable.}

\item{siteneame.forsub}{A character string identifying the target site. Used to validate data alignment if \code{option.check.name = TRUE}.}

\item{option.check.name}{Logical. Whether to check if \code{siteneame.forsub} matches identifiers in \code{bio_data}. Default is \code{TRUE}.}

\item{climate_data}{A data frame of daily climate data. Must include columns for \code{year}, \code{yday}, and the climate variable used in the model.}

\item{refday}{Integer. The reference day of year (e.g., 305 for Nov 1) from which to count backwards. Default is 305.}

\item{lastdays}{Integer. Number of days prior to \code{refday} to include in the climate window. Default is \code{max(range)}.}

\item{rollwin}{Integer. Size of the rolling window applied to the climate variable. Default is 1 (no smoothing).}

\item{optim.k}{Logical. Whether to optimize the GAM smoothness (\code{k}). Default is \code{FALSE}. Recommended to be \code{FALSE} for small time series.}

\item{formula_model}{A model formula (e.g., \code{log.seed ~ TMEAN}). Used for downstream model fitting on extracted windows.}

\item{model_type}{Model type for window-based modeling. Either \code{'lm'} (default) or \code{'betareg'}. For now only lm option is available (but we are planing for future option)}

\item{yearneed}{Integer. Minimum number of years of data to include before modeling. Used to define valid years. Default is 2.}

\item{k.provided}{Optional. An integer to manually set the number of knots (\code{k}) for GAM smoothing. If \code{NA} (default), it uses \code{nrow(bio_data) - 1}.}
}
\value{
A data frame summarizing the model fit for each identified weather cue window, including:
\itemize{
\item \code{window.open}, \code{window.close}: Start and end of the cue window (in days before \code{refday})
\item \code{estimate}, \code{intercept}: Model coefficients from fitting the biological response to the cue
\item \code{r2}, \code{AIC}, \code{nobs}: Model diagnostics and number of observations
\item \code{sitenewname}, \code{plotname.lon.lat}: Site identifiers
}
}
\description{
Identifies the most influential weather cue windows at a given site using the Climate Sensitivity Profile (CSP) method.
This method smooths the relationship between climate covariates and a biological response over daily lags using GAMs, and extracts
periods of jointly strong slope and R² signals. These windows are then used to fit predictive models and evaluate their performance.
}
\details{
The Climate Sensitivity Profile (CSP) approach builds on daily linear models to estimate the strength of association between a climate variable
and a biological response. These daily slopes and R² values are smoothed with GAMs, and time windows are extracted where both metrics show consistent signal.

The extracted windows are used to compute rolling means over historical climate data, which are then used to fit simple models on the biological data.
}
\examples{
\dontrun{
runing_csp(
  Results_days = my_daily_CSP_results,
  bio_data = bio_df,
  climate_data = climate_df,
  siteneame.forsub = "Site_001",
  refday = 305,
  lastdays = 600,
  formula_model = formula('log.seed ~ TMEAN')
)
}

}
\seealso{
\code{\link{optimize_and_fit_gam}}, \code{\link{get_predictions_windows}},
\code{\link{extract_consecutive_sequences}}, \code{\link{reruning_windows_modelling}}
}
