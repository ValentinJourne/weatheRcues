% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runing_csp.R
\name{runing_csp}
\alias{runing_csp}
\title{Run Climate Sensitivity Profile (CSP) Window Identification for a Site}
\usage{
runing_csp(
  Results_days = Results_days,
  bio_data = bio_data,
  siteneame.forsub = siteneame.forsub,
  option.check.name = TRUE,
  climate_data = climate_data,
  refday = 305,
  lastdays = max(range),
  rollwin = 1,
  optim.k = F,
  formula_model = formula("seed~TMEAN"),
  model_type = "lm",
  yearneed = 2,
  k.provided = NA
)
}
\arguments{
\item{Results_days}{A data frame containing at least columns \code{estimate} (slope) and \code{r.squared} (model $R^2$) for each lagged day.}

\item{bio_data}{A data frame containing biological observations (e.g., seed production), with identifiers such as \code{plotname.lon.lat}, \code{sitenewname}, and the response variable (e.g., \code{log.seed}).}

\item{siteneame.forsub}{Character. The unique site name to be validated against \code{bio_data}.}

\item{option.check.name}{Logical. Whether to validate that \code{siteneame.forsub} matches site identifiers in \code{bio_data}. Default is TRUE.}

\item{climate_data}{A data frame containing daily climate values for the site, with \code{year}, \code{yday}, and the climate variable of interest.}

\item{refday}{Integer. The reference day of year (DOY) from which to compute backward days (default is 305, i.e., November 1st).}

\item{lastdays}{Integer. Number of days to look back from the reference day. Default is the maximum of the defined range.}

\item{rollwin}{Integer. Size of the rolling window for smoothing the climate variable. Default is 1 (no smoothing).}

\item{optim.k}{Logical. Whether to optimize the GAM knot complexity automatically. Default is FALSE (recommended to avoid overfitting in short time series).}

\item{formula_model}{A formula object defining the relationship to fit (e.g., \code{log.seed ~ TMEAN}).}

\item{model_type}{Character. Either \code{'lm'} or \code{'betareg'} for model fitting type. Default is \code{'lm'}.}

\item{yearneed}{Integer. Minimum number of years of historical data needed to calculate lagged climate windows. Default is 2.}
}
\value{
A data frame containing, for each selected window:
\itemize{
\item Window opening and closing dates (\code{window.open}, \code{window.close})
\item Model performance metrics (e.g., \code{r2}, \code{AIC}, \code{estimate}, \code{intercept})
\item Number of observations used, window identifier, and reference day
}
}
\description{
This function identifies the most influential weather cue windows at a site using the Climate Sensitivity Profile (CSP) method. It fits generalized additive models (GAMs) to the relationship between slope and $R^2$ values over a series of daily windows and identifies periods where both metrics jointly indicate a strong climate signal. It then extracts these windows and fits linear models to the biological response using climate data smoothed with a rolling average.
}
\details{
This function:
\itemize{
\item Fits smoothed GAMs to the slopes and $R^2$ values from the CSP results.
\item Detects sequences of days with high combined signal strength using thresholds derived from GAM predictions.
\item Extracts and formats these windows, then uses \code{reruning_windows_modelling()} to fit models over the selected periods.
\item Applies a rolling window to climate data across all years needed to support modeling.
}
}
\note{
This function assumes daily resolution and that column names (e.g., \code{log.seed}, \code{TMEAN}) are consistent across inputs. Validate \code{bio_data} and \code{climate_data} for consistency before using.
}
\examples{
\dontrun{
result <- runing_csp(
  Results_days = CSP_output[["Site_1"]],
  bio_data = bio_data,
  climate_data = climate_data,
  siteneame.forsub = "Site_1",
  refday = 305,
  lastdays = 600
)
}

}
\seealso{
\code{\link{optimize_and_fit_gam}}, \code{\link{reruning_windows_modelling}}, \code{\link{get_predictions_windows}}, \code{\link{extract_consecutive_sequences}}
}
